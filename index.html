<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FirstyWorld - –†–∏—Å–æ–≤–∞–ª–∫–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #ffffff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    .avatar-preview {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #4B5563;
      cursor: pointer;
      background-color: #6B7280;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
      text-align: center;
    }
    .avatar-preview img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }
    #avatarInput {
      display: none;
    }
    #drawCanvas {
      width: 100%;
      height: 100%;
      max-width: 800px;
      max-height: 600px;
    }
  </style>
  <style>.corner-text-right{position:fixed;bottom:10px;right:10px;color:white}.corner-text-left{position:fixed;bottom:10px;left:10px;color:white}</style>
<div class="corner-text-right"><a href="https://example.com">–°—Å—ã–ª–∫–∞</a></div>
<div class="corner-text-left">Second Alpha Version</div>
<style>.img-center{display:block;margin:0 auto;padding-top:10px}</style>
<style>.corner-text{position:fixed;bottom:10px;right:10px;color:white}</style>
<div class="corner-text">this is a parody game of<a href="https://drawaria.online/"> Drawaria.online</a></div>
</head>
<body id="body" class="bg-gray-900 text-white flex items-center justify-center min-h-screen transition-all duration-300">
  <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="loadingScreen" class="fixed inset-0 bg-gray-900 flex items-center justify-center">
    <div class="spinner"></div>
  </div>
  <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
  <div id="mainMenu" class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md text-center hidden theme-box">
    <!-- –ù–∏–∫–Ω–µ–π–º –∏ –∞–≤–∞—Ç–∞—Ä–∫–∞ -->
    <div class="flex flex-col items-center mb-6">
    <img src="firstyworld.png" class="img-center"> <label class="block mb-2"></label>
      <input id="nickname" type="text" class="w-32 p-2 bg-gray-700 rounded mb-4" placeholder="–ù–∏–∫–Ω–µ–π–º">
      <div id="avatarPreview" class="avatar-preview" onclick="document.getElementById('avatarInput').click()">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä</div>
      <input id="avatarInput" type="file" accept="image/*">
    </div>
    <div class="flex flex-col gap-4">
      <button onclick="joinRandomRoom()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-all">–ò–≥—Ä–∞—Ç—å</button>
      <div class="relative">
        <button onclick="showCreateRoomModal()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded transition-all">–°–æ–∑–¥–∞—Ç—å –ö–æ–º–Ω–∞—Ç—É</button>
        <button onclick="toggleServerList()" class="absolute right-0 top-0 h-full px-2 bg-green-700 hover:bg-green-800 rounded-r">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <div id="serverList" class="absolute hidden w-full bg-gray-700 rounded mt-2 shadow-lg z-10">
          <button onclick="joinRoom('room1')" class="block w-full text-left px-4 py-2 hover:bg-gray-600">–ö–æ–º–Ω–∞—Ç–∞ 1</button>
          <button onclick="joinRoom('room2')" class="block w-full text-left px-4 py-2 hover:bg-gray-600">–ö–æ–º–Ω–∞—Ç–∞ 2</button>
          <button onclick="joinRoom('room3')" class="block w-full text-left px-4 py-2 hover:bg-gray-600">–ö–æ–º–Ω–∞—Ç–∞ 3</button>
        </div>
      </div>
      <button onclick="showSettingsModal()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <button onclick="window.location.href='rules.html'" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–ü—Ä–∞–≤–∏–ª–∞</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã -->
  <div id="createRoomModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-full max-w-sm theme-box">
      <h2 class="text-xl font-bold mb-4">–°–æ–∑–¥–∞—Ç—å –ö–æ–º–Ω–∞—Ç—É</h2>
      <label class="block mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –ö–æ–º–Ω–∞—Ç—ã:</label>
      <input id="roomName" type="text" class="w-full p-2 bg-gray-700 rounded mb-4" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
      <label class="block mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ò–≥—Ä–æ–∫–æ–≤ (1-10):</label>
      <input id="playerCount" type="number" min="1" max="10" value="4" class="w-full p-2 bg-gray-700 rounded mb-4">
      <div class="flex justify-end gap-2">
        <button onclick="createRoom()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded transition-all">–°–æ–∑–¥–∞—Ç—å</button>
        <button onclick="closeModal('createRoomModal')" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded transition-all">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-full max-w-md theme-box">
      <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <div class="flex gap-2 mb-4">
        <button onclick="showTab('infoTab')" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
        <button onclick="showTab('audioTab')" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–ê—É–¥–∏–æ</button>
        <button onclick="showTab('themeTab')" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–§–æ–Ω—ã</button>
      </div>
      <!-- –í–∫–ª–∞–¥–∫–∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div id="infoTab" class="tab-content">
        <p class="mb-2">–í–∞—à–∞ –†–û–õ–¨: –ò–≥—Ä–æ–∫</p>
        <p class="mb-2">–î–æ–Ω–∞—Ç: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
        <button id="logoutButton" onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded transition-all hidden">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
      </div>
      <!-- –í–∫–ª–∞–¥–∫–∞ –ê—É–¥–∏–æ -->
      <div id="audioTab" class="tab-content hidden">
        <label class="block mb-2">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</label>
        <select id="notifications" class="w-full p-2 bg-gray-700 rounded mb-4">
          <option value="on">–í–∫–ª</option>
          <option value="off">–í—ã–∫–ª</option>
        </select>
        <label class="block mb-2">–ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–æ–≤:</label>
        <input id="soundVolume" type="range" min="0" max="100" value="50" class="w-full mb-4">
        <label class="block mb-2">–ú—É–∑—ã–∫–∞:</label>
        <select id="music" class="w-full p-2 bg-gray-700 rounded mb-4">
          <option value="music1.mp3">–ú—É–∑—ã–∫–∞ 1</option>
          <option value="music2.mp3">–ú—É–∑—ã–∫–∞ 2</option>
          <option value="music3.mp3">–ú—É–∑—ã–∫–∞ 3</option>
        </select>
        <label class="block mb-2">–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏:</label>
        <input id="musicVolume" type="range" min="0" max="100" value="50" class="w-full mb-4">
      </div>
      <!-- –í–∫–ª–∞–¥–∫–∞ –§–æ–Ω—ã -->
      <div id="themeTab" class="tab-content hidden">
        <label class="block mb-2">–¢–µ–º–∞:</label>
        <select id="theme" class="w-full p-2 bg-gray-700 rounded mb-4" onchange="changeTheme()">
          <option value="dark">–¢–µ–º–Ω—ã–π –†–µ–∂–∏–º</option>
          <option value="light">–°–≤–µ—Ç–ª—ã–π –†–µ–∂–∏–º</option>
          <option value="blue-pink">–°–∏–Ω–µ-–†–æ–∑–æ–≤—ã–π –†–µ–∂–∏–º</option>
        </select>
      </div>
      <div class="flex justify-end">
        <button onclick="closeModal('settingsModal')" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded transition-all">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–Ω–∞—Ç—ã -->
  <div id="roomInterface" class="hidden min-h-screen flex theme-box w-full">
    <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
    <div class="w-1/5 bg-gray-800 p-4 theme-box">
      <h2 class="text-xl font-bold mb-4">–ò–≥—Ä–æ–∫–∏</h2>
      <ul id="playerList" class="space-y-2"></ul>
    </div>
    <!-- –•–æ–ª—Å—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è -->
    <div class="w-3/5 bg-gray-700 flex flex-col items-center justify-center relative theme-box">
      <div class="absolute top-4 right-4 flex gap-2">
        <button onclick="exitRoom()" class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded transition-all">–í—ã–π—Ç–∏</button>
        <button onclick="nextRoom()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-all">–°–ª–µ–¥—É—é—â–∞—è –∫–æ–º–Ω–∞—Ç–∞</button>
      </div>
      <canvas id="drawCanvas" class="border-2 border-gray-600 bg-white"></canvas>
      <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
      <div class="flex justify-center gap-4 mt-4 bg-gray-800 p-2 rounded theme-box">
        <button id="brushTool" onclick="setTool('brush')" class="bg-gray-600 hover:bg-gray-700 p-2 rounded text-2xl" title="–ö–∏—Å—Ç—å">üñåÔ∏è</button>
        <button id="eraserTool" onclick="setTool('eraser')" class="bg-gray-600 hover:bg-gray-700 p-2 rounded text-2xl" title="–õ–∞—Å—Ç–∏–∫">üßπ</button>
        <input id="brushSize" type="range" min="1" max="50" value="5" class="w-24" title="–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏">
        <input id="colorPicker" type="color" value="#000000" class="w-10 h-10 p-1 rounded" title="–í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞">
        <button id="fillTool" onclick="setTool('fill')" class="bg-gray-600 hover:bg-gray-700 p-2 rounded text-2xl" title="–í–µ–¥—Ä–æ">ü™£</button>
        <button onclick="undo()" class="bg-gray-600 hover:bg-gray-700 p-2 rounded text-2xl" title="–û—Ç–∫–∞—Ç">‚Ü©Ô∏è</button>
      </div>
    </div>
    <!-- –ß–∞—Ç –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="w-1/5 bg-gray-800 p-4 theme-box">
      <h2 class="text-xl font-bold mb-4">–ß–∞—Ç</h2>
      <div id="chat" class="h-64 overflow-y-auto bg-gray-700 p-2 rounded mb-4"></div>
      <input id="chatInput" type="text" class="w-full p-2 bg-gray-700 rounded mb-2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
      <div class="flex gap-2">
        <button onclick="sendMessage()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-all">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="clearChat()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button onclick="copyRoomLink()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded transition-all">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      </div>
    </div>
  </div>

  <script>
    let isLoggedIn = false;
    let nickname = localStorage.getItem('nickname') || '–ì–æ—Å—Ç—å';
    let avatar = localStorage.getItem('avatar') || null;
    let currentRoomId = null;
    let currentTool = 'brush';
    let undoStack = [];
    let p5Instance = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    window.onload = () => {
      if (nickname !== '–ì–æ—Å—Ç—å') {
        document.getElementById('nickname').value = nickname;
        isLoggedIn = true;
        document.getElementById('logoutButton').classList.remove('hidden');
      }
      if (avatar) {
        document.getElementById('avatarPreview').innerHTML = `<img src="${avatar}" alt="–ê–≤–∞—Ç–∞—Ä">`;
      }
      setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('mainMenu').classList.remove('hidden');
      }, 2000);
    };

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    function showModal(modalId) {
      document.getElementById(modalId).classList.remove('hidden');
    }
    function closeModal(modalId) {
      document.getElementById(modalId).classList.add('hidden');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∫–ª–∞–¥–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
      document.getElementById(tabId).classList.remove('hidden');
    }

    // –°–º–µ–Ω–∞ —Ç–µ–º—ã
    function changeTheme() {
      const theme = document.getElementById('theme').value;
      const body = document.getElementById('body');
      const boxes = document.querySelectorAll('.theme-box');
      if (theme === 'light') {
        body.classList.remove('bg-gray-900', 'bg-gradient-to-r', 'from-blue-500', 'to-pink-500');
        body.classList.add('bg-gray-100');
        boxes.forEach(el => {
          el.classList.remove('bg-gray-800', 'text-white');
          el.classList.add('bg-white', 'text-black');
        });
      } else if (theme === 'blue-pink') {
        body.classList.remove('bg-gray-900', 'bg-gray-100');
        body.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-pink-500');
        boxes.forEach(el => {
          el.classList.remove('bg-white', 'text-black');
          el.classList.add('bg-gray-800', 'text-white');
        });
      } else {
        body.classList.remove('bg-gray-100', 'bg-gradient-to-r', 'from-blue-500', 'to-pink-500');
        body.classList.add('bg-gray-900');
        boxes.forEach(el => {
          el.classList.remove('bg-white', 'text-black');
          el.classList.add('bg-gray-800', 'text-white');
        });
      }
    }

    // –í—Ö–æ–¥/–≤—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
    function logout() {
      isLoggedIn = false;
      nickname = '–ì–æ—Å—Ç—å';
      avatar = null;
      localStorage.removeItem('nickname');
      localStorage.removeItem('avatar');
      document.getElementById('logoutButton').classList.add('hidden');
      document.getElementById('nickname').value = '';
      document.getElementById('avatarPreview').innerHTML = '–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä';
      alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞');
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∏–∫–Ω–µ–π–º–∞ –∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
    document.getElementById('nickname').addEventListener('change', (e) => {
      nickname = e.target.value || '–ì–æ—Å—Ç—å';
      localStorage.setItem('nickname', nickname);
      isLoggedIn = true;
      document.getElementById('logoutButton').classList.remove('hidden');
    });
    document.getElementById('avatarInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          avatar = event.target.result;
          localStorage.setItem('avatar', avatar);
          document.getElementById('avatarPreview').innerHTML = `<img src="${avatar}" alt="–ê–≤–∞—Ç–∞—Ä">`;
          isLoggedIn = true;
          document.getElementById('logoutButton').classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
    function toggleServerList() {
      document.getElementById('serverList').classList.toggle('hidden');
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ ID –∫–æ–º–Ω–∞—Ç—ã
    function generateRoomId() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < 8; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
    function createRoom() {
      const roomName = document.getElementById('roomName').value || '–ö–æ–º–Ω–∞—Ç–∞';
      const playerCount = document.getElementById('playerCount').value;
      currentRoomId = generateRoomId();
      const roomUrl = `${window.location.origin}/rooms/${currentRoomId}`;
      closeModal('createRoomModal');
      showRoomInterface(roomName, playerCount, roomUrl);
    }

    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–ª—É—á–∞–π–Ω–æ–π –∫–æ–º–Ω–∞—Ç–µ
    function joinRandomRoom() {
      currentRoomId = generateRoomId();
      const roomUrl = `${window.location.origin}/rooms/${currentRoomId}`;
      showRoomInterface('–°–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞', 4, roomUrl);
    }

    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
    function joinRoom(roomId) {
      currentRoomId = roomId;
      const roomUrl = `${window.location.origin}/rooms/${currentRoomId}`;
      showRoomInterface(`–ö–æ–º–Ω–∞—Ç–∞ ${roomId}`, 4, roomUrl);
      toggleServerList();
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–Ω–∞—Ç—ã
    function showRoomInterface(roomName, playerCount, roomUrl) {
      document.getElementById('mainMenu').classList.add('hidden');
      document.getElementById('roomInterface').classList.remove('hidden');
      const playerList = document.getElementById('playerList');
      playerList.innerHTML = `
        <li class="flex items-center gap-2">
          ${avatar ? `<img src="${avatar}" class="w-8 h-8 rounded-full" alt="–ê–≤–∞—Ç–∞—Ä">` : ''}
          ${nickname} (–í—ã)
        </li>`;
      document.getElementById('chat').innerHTML = `<p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–Ω–∞—Ç—É: ${roomName}</p>`;
      setupCanvas();
    }

    // –í—ã—Ö–æ–¥ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã
    function exitRoom() {
      document.getElementById('roomInterface').classList.add('hidden');
      document.getElementById('mainMenu').classList.remove('hidden');
      if (p5Instance) {
        p5Instance.remove();
        p5Instance = null;
      }
      currentRoomId = null;
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–Ω–∞—Ç—É
    function nextRoom() {
      if (p5Instance) {
        p5Instance.remove();
        p5Instance = null;
      }
      currentRoomId = generateRoomId();
      const roomUrl = `${window.location.origin}/rooms/${currentRoomId}`;
      showRoomInterface('–°–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞', 4, roomUrl);
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–º–Ω–∞—Ç—É
    function copyRoomLink() {
      const roomUrl = `${window.location.origin}/rooms/${currentRoomId}`;
      navigator.clipboard.writeText(roomUrl).then(() => {
        alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
      });
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function sendMessage() {
      const chatInput = document.getElementById('chatInput');
      const message = chatInput.value;
      if (message) {
        const chat = document.getElementById('chat');
        chat.innerHTML += `<p><strong>${nickname}:</strong> ${message}</p>`;
        chat.scrollTop = chat.scrollHeight;
        chatInput.value = '';
      }
    }

    // –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞
    function clearChat() {
      document.getElementById('chat').innerHTML = '';
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    function showCreateRoomModal() {
      showModal('createRoomModal');
    }
    function showSettingsModal() {
      showModal('settingsModal');
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö–æ–ª—Å—Ç–∞ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
    function setupCanvas() {
      if (p5Instance) {
        p5Instance.remove();
        p5Instance = null;
      }
      let sketch = function(p) {
        let canvas;
        p.setup = function() {
          canvas = p.createCanvas(800, 600);
          p.background(255);
          p.noFill();
          undoStack = [];
          saveCanvasState();
          canvas.canvas.style.touchAction = 'none'; // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö –∂–µ—Å—Ç–æ–≤
        };
        p.draw = function() {
          if (p.mouseIsPressed && p.mouseX >= 0 && p.mouseX <= p.width && p.mouseY >= 0 && p.mouseY <= p.height) {
            if (currentTool === 'brush') {
              p.stroke(document.getElementById('colorPicker').value);
              p.strokeWeight(document.getElementById('brushSize').value);
              p.line(p.mouseX, p.mouseY, p.pmouseX, p.pmouseY);
            } else if (currentTool === 'eraser') {
              p.stroke(255);
              p.strokeWeight(document.getElementById('brushSize').value);
              p.line(p.mouseX, p.mouseY, p.pmouseX, p.pmouseY);
            }
          }
        };
        p.touchMoved = function() {
          if (currentTool === 'brush') {
            p.stroke(document.getElementById('colorPicker').value);
            p.strokeWeight(document.getElementById('brushSize').value);
            p.line(p.mouseX, p.mouseY, p.pmouseX, p.pmouseY);
          } else if (currentTool === 'eraser') {
            p.stroke(255);
            p.strokeWeight(document.getElementById('brushSize').value);
            p.line(p.mouseX, p.mouseY, p.pmouseX, p.pmouseY);
          }
          return false; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏
        };
        p.mouseReleased = function() {
          if (currentTool === 'fill') {
            p.background(document.getElementById('colorPicker').value);
          }
          saveCanvasState();
        };
        p.touchEnded = function() {
          if (currentTool === 'fill') {
            p.background(document.getElementById('colorPicker').value);
          }
          saveCanvasState();
          return false;
        };
      };
      p5Instance = new p5(sketch, 'drawCanvas');
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–æ–ª—Å—Ç–∞
    function saveCanvasState() {
      const canvas = document.querySelector('#drawCanvas');
      undoStack.push(canvas.toDataURL());
      if (undoStack.length > 50) undoStack.shift();
    }

    // –û—Ç–∫–∞—Ç –¥–µ–π—Å—Ç–≤–∏—è
    function undo() {
      if (undoStack.length > 1) {
        undoStack.pop();
        const img = new Image();
        img.src = undoStack[undoStack.length - 1];
        img.onload = () => {
          const p5Canvas = document.querySelector('#drawCanvas').getContext('2d');
          p5Canvas.clearRect(0, 0, 800, 600);
          p5Canvas.drawImage(img, 0, 0);
        };
      }
    }

    // –í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
    function setTool(tool) {
      currentTool = tool;
      document.querySelectorAll('#brushTool, #eraserTool, #fillTool').forEach(btn => btn.classList.remove('bg-blue-600'));
      document.getElementById(`${tool}Tool`).classList.add('bg-blue-600');
      if (tool === 'fill') {
        document.getElementById('drawCanvas').getContext('2d').fillStyle = document.getElementById('colorPicker').value;
      }
    }

    // –ê—É–¥–∏–æ
    const clickSound = new Audio('click.mp3');
    document.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', () => {
        if (document.getElementById('notifications').value === 'on') {
          clickSound.volume = document.getElementById('soundVolume').value / 100;
          clickSound.play();
        }
      });
    });

    const backgroundMusic = new Audio();
    document.getElementById('music').addEventListener('change', (e) => {
      backgroundMusic.src = e.target.value;
      backgroundMusic.loop = true;
      backgroundMusic.play();
    });
    document.getElementById('musicVolume').addEventListener('input', (e) => {
      backgroundMusic.volume = e.target.value / 100;
    });
  </script>
</body>
</html>